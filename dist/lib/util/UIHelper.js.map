{"version":3,"file":"UIHelper.js","sourceRoot":"","sources":["../../../src/lib/util/UIHelper.ts"],"names":[],"mappings":"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","sourcesContent":["import path from 'path';\nimport fs from 'fs';\nimport arrayShuffle from 'array-shuffle';\nimport mixcloud from '../MixcloudContext';\n\nexport interface UILink {\n  icon?: {\n    type: 'fa' | 'mixcloud',\n    float?: string,\n    color?: string,\n    class?: string\n  };\n  style?: string;\n  target?: string;\n  text: string;\n  url: string;\n  onclick?: string;\n}\n\nexport const UI_STYLES = {\n  EXCLUSIVE: 'color: #b38536; font-size: 10px; padding-right: 8px;',\n  NEXT_PAGE: 'color: #7a848e;',\n  LIST_ITEM_SELECTED: 'color: #54c688; font-weight: bold;',\n  TITLE_CASE: 'text-transform: capitalize;',\n  DESCRIPTION: 'color: #ddd; font-size: 14px; padding-top: 12px;',\n  EXCLUSIVE_DESC: 'color: #ce9a42; font-size: 14px; font-weight: bold;',\n  VIEW_LINK: 'color: #ebaca0;',\n  PARAMS_LIST_ITEM_NAME: 'color: #ccc; margin-right: 5px;'\n};\n\ninterface RandomAlbumArt {\n  currentIndex: number | null;\n  uris: string[];\n}\n\nexport default class UIHelper {\n\n  static #rndAlbumArt: Record<string, RandomAlbumArt> | null = null;\n\n  static getMixcloudIcon() {\n    return `<img src=\"/albumart?sourceicon=${encodeURIComponent('music_service/mixcloud/dist/assets/images/mixcloud-sq.png')}\" style=\"width: 32px; height: 32px; margin-right: 8px;\" />`;\n  }\n\n  static addMixcloudIconToListTitle(s: string) {\n    if (!this.supportsEnhancedTitles()) {\n      return s;\n    }\n    return `${this.getMixcloudIcon()}${s}`;\n  }\n\n  static addIconToListTitle(faClass: string, s: string) {\n    if (!this.supportsEnhancedTitles()) {\n      return s;\n    }\n    return `<i class=\"${faClass}\" style=\"padding-right: 15px;\"></i>${s}`;\n  }\n\n  static styleText(s: string, style: string) {\n    return `<span${style ? ` style='${style}'` : ''}>${s}</span>`;\n  }\n\n  static wrapInDiv(s: string, style: string) {\n    return `<div${style ? ` style='${style}'` : ''}>${s}</div>`;\n  }\n\n  static addTextBefore(s: string, textToAdd: string, style: string) {\n    return this.styleText(textToAdd, style) + s;\n  }\n\n  static addExclusiveText(s: string) {\n    return this.addTextBefore(s, mixcloud.getI18n('MIXCLOUD_EXCLUSIVE'), UI_STYLES.EXCLUSIVE);\n  }\n\n  static getMoreText() {\n    return this.styleText(mixcloud.getI18n('MIXCLOUD_MORE'), UI_STYLES.NEXT_PAGE);\n  }\n\n  static constructListTitleWithLink(title: string, links: UILink | UILink[], isFirstList: boolean) {\n    if (!this.supportsEnhancedTitles()) {\n      return title;\n    }\n    let html = `<div style=\"display: flex; width: 100%; align-items: flex-end;${isFirstList ? '' : ' margin-top: -24px;'}\">\n                    <div>${title}</div>\n                    <div style=\"flex-grow: 1; text-align: right; font-size: small;\">`;\n\n    if (Array.isArray(links)) {\n      links.forEach((link, index) => {\n        html += this.#constructLinkItem(link);\n        if (index < links.length - 1) {\n          html += '<span style=\"padding: 0px 5px;\">|</span>';\n        }\n      });\n    }\n    else {\n      html += this.#constructLinkItem(links);\n    }\n\n    html += '</div></div>';\n\n    return html;\n  }\n\n  static #constructLinkItem(link: UILink) {\n    let html = '';\n    if (link.icon) {\n      if (link.icon.type === 'fa' && link.icon.float !== 'right') {\n        html += `<i class=\"${link.icon.class}\" style=\"position: relative; top: 1px; margin-right: 2px; font-size: 16px;${link.icon.color ? ` color: ${link.icon.color};` : ''}\"></i>`;\n      }\n      else if (link.icon.type === 'mixcloud') {\n        html += `<img src=\"/albumart?sourceicon=${encodeURIComponent('music_service/mixcloud/dist/assets/images/mixcloud-sq.png')}\" style=\"width: 32px; height: 32px; margin-right: 5px; margin-top: -1px;\" />`;\n      }\n    }\n    html += `<a${link.target ? ` target=\"${link.target}\"` : ''}${link.style ? ` style=\"${link.style}\"` : ''} href=\"${link.url}\"${link.onclick ? ` onclick=\"${link.onclick}\"` : ''}>\n                    ${link.text}\n                </a>`;\n    if (link.icon && link.icon.type === 'fa' && link.icon.float === 'right') {\n      html += `<i class=\"${link.icon.class}\" style=\"position: relative; top: 1px; margin-left: 2px; font-size: 16px;${link.icon.color ? ` color: ${link.icon.color};` : ''}\"></i>`;\n    }\n\n    return html;\n  }\n\n  static constructBrowsePageLink(text: string, uri: string, icon: UILink['icon']) {\n    return {\n      url: '#',\n      text,\n      onclick: `angular.element('#browse-page').scope().browse.fetchLibrary({uri: '${uri}'}, true)`,\n      icon\n    };\n  }\n\n  static getRandomAlbumArtFromDir(dirname: string) {\n    const uriPathPrefix = `music_service/mixcloud/dist/assets/images/${dirname}/`;\n    const dir = path.resolve(__dirname, `../../assets/images/${dirname}`);\n    if (!this.#rndAlbumArt) {\n      this.#rndAlbumArt = {};\n    }\n    let rnd = this.#rndAlbumArt[dirname];\n    if (!rnd) {\n      rnd = this.#rndAlbumArt[dirname] = {\n        currentIndex: null,\n        uris: []\n      };\n      fs.readdirSync(dir).forEach((file) => {\n        if (fs.lstatSync(path.resolve(dir, file)).isFile()) {\n          const uriPath = uriPathPrefix + file;\n          rnd.uris.push(\n            `/albumart?sourceicon=${encodeURIComponent(uriPath)}`\n          );\n        }\n      });\n    }\n    if (!rnd.uris) {\n      return null;\n    }\n    if (rnd.currentIndex === null) {\n      rnd.uris = arrayShuffle(rnd.uris);\n      rnd.currentIndex = 0;\n    }\n    const albumart = rnd.uris[rnd.currentIndex] || null;\n    rnd.currentIndex++;\n    if (rnd.currentIndex >= rnd.uris.length) {\n      rnd.currentIndex = null;\n    }\n    return albumart;\n  }\n\n  static supportsEnhancedTitles() {\n    return !this.isManifestUI();\n  }\n\n  static isManifestUI() {\n    const volumioManifestUIDir = '/volumio/http/www4';\n    const volumioManifestUIDisabledFile = '/data/disableManifestUI';\n    return fs.existsSync(volumioManifestUIDir) && !fs.existsSync(volumioManifestUIDisabledFile);\n  }\n}\n"]}